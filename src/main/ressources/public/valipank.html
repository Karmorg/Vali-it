<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vali IT pank</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<img src="logo.jpg"/>

<h1 id="h1">Internetipank</h1>

<!--pooleli-->
<h3 id="hakka_kliendiks"> Hakka kliendiks</h3>
<p>Sisesta enda andmed tabelisse ja vajuta "Tulen üle" nupule.</p>

<table name="newClientTable" border="1">
    <tr>
        <th>Eesnimi</th>
        <th>Perekonnanimi</th>
        <th>Isikukood</th>
    </tr>
    <tr>
        <td><input id="fName" type="text"></td>
        <td><input id="lName" type="text"></td>
        <td><input id="iDCode" type="number"></td>
    </tr>
</table>

<a href="https://github.com/siimrebane/vali-it">Tutvu tingimustega</a>
<p><input id="createClientButton" type="button" value="Tulen üle"></p>

<h3 id="createAccountHeader"> Loo konto</h3>
<p>Uue konto loomiseks sisesta enda kliendi nr <input id="clientNoForNewAccount" type="number">
    ja vajuta <input id="createAccountButton" type="button" value="sellele nupule."></p>

<h3 id="clientAccountsHeader"> Kliendi kontod</h3>
<p>Vaata klient nr <input id="clientNoForAccounts" type="number" > <input id="myAccountsButton" type="button" value="kontosid."></p>
<div id="myAccountsContent">
</div>
<br>

<h3 id="konoto_seis"> Konto seis</h3>
<p>Vaata konto nr <input id="clientNoForBalance" type="number" > <input id="balanceButton" type="button" value="seisu."></p>
<div id="myBalanceContent">
</div>
<br>

<h3 id="historyHeading"> Tehingute ajalugu</h3>
<p>Vaata konto nr <input id="clientNoForHistory" type="number" > tehingute ajalugu <input id="historyButton" type="button" value="siit."></p>
<div id="historyContent">
</div>
<br>

<h3 id="allAccountsHeader"> Kõik kontod</h3>
<p>Kõigi kontode nimekirja saab <input id="accounts" type="button" value="siit."></p>
<div id="accountsContent">
</div>
<br>

<h3> Ülekanded</h3>
<p> Sisesta konto nr ja vajuta soovitud tehingu nimega nupule.</p>
<p>Konto <input id="transactionAccountNo" type="number"></p>
<p>Summa <input id="transactionAmount" type="number"></p>
<p><input id="depositButton" type="button" value="Kanna arvele">  <input id="withdrawButton" type="button" value="Võta välja"></p>
<p>Kanna arvelt nr <input id="accountNoTransferFrom" type="number"> arvele <input id="accountNoTransferTo" type="number">
summa <input id="amountTransfer" type="number"> </p>
<p> <input id="transferButton" type="button" value="Soorita ülekanne"></p>

<a href="#h1"> Tagasi üles</a>

<br><br>


<script>



    let transferButton = document.getElementById("transferButton");
    transferButton.onclick = function (){
        let accountNoFrom = document.getElementById("accountNoTransferFrom");
        let accountNoTo = document.getElementById("accountNoTransferTo");
        let amount = document.getElementById("amountTransfer");
        fetch('http://localhost:8080/transfere/' + accountNoFrom.value + '/' + accountNoTo.value,
            {
                method: 'PUT',
                headers: {
                    'Content-Type':'application/json'
                },
                body: JSON.stringify({amount: amount.value})
            })
            .then(result =>result.text())
            .then(function (transfer){
                    alert(transfer);
                }
            )
    }


    let createClientButton = document.getElementById("createClientButton");
    createClientButton.onclick = function (){
        let fName = document.getElementById("fName");
        let lName = document.getElementById("lName");
        fetch('http://localhost:8080/clients/' + fName.value +"/" +lName.value,
            {
                method: 'POST',
                headers: {
                    'Content-Type':'application/json'
                }
            })
            .then(result =>result.json())
            .then(function (client){
                alert("Sinu kliendi nr on: " + client);
                }
            )
    }

    let createAccountButton = document.getElementById("createAccountButton");
    createAccountButton.onclick = function (){
        let clientNo =document.getElementById("clientNoForNewAccount");
        fetch('http://localhost:8080/accounts/' + clientNo.value,
            {
                method: 'POST',
                headers:{
                    'Content-Type':'application/json'
                }
            })
            .then(result =>result.json())
            .then(function (account){
                alert("Sinu uue konto nr on " + account);
                }
            )
    }

    let accountsContent = document.getElementById("accountsContent");
    let myAccountsContent = document.getElementById("myAccountsContent");
    let accountsTable = document.createElement("table");

    function accountsList (accounts){
        accountsTable.innerHTML = "";
        let newRow = document.createElement("tr");
        let newCell = document.createElement("td");
        newCell.innerText = "Account no";
        newRow.append(newCell);
        let newCell2 = document.createElement("td");
        newCell2.innerText = "Client no";
        newRow.append(newCell2);
        let newCell3 = document.createElement("td");
        newCell3.innerText = "Balance";
        newRow.append(newCell3);
        accountsTable.append(newRow);

        for (let i=0; i< accounts.length; i++){
            let newRow = document.createElement("tr");
            let newCell = document.createElement("td");
            newCell.innerText = accounts[i].accountNo;
            newRow.append(newCell);
            let newCell2 = document.createElement("td");
            newCell2.innerText = accounts[i].clientId;
            newRow.append(newCell2);
            let newCell3 = document.createElement("td");
            newCell3.innerText = accounts[i].balance;
            newRow.append(newCell3);
            accountsTable.append(newRow);
        }
    }

    let accountsButton = document.getElementById("accounts");
    accountsButton.onclick = function (){

        accountsTable.setAttribute('border', '1');
        fetch('http://localhost:8080/accounts')
            .then(result => result.json())
            .then(accountsList)
            .then(accountsContent.append(accountsTable))
    }
    let myBalance = document.getElementById("balanceButton");
    myBalance.onclick = function (){
        let myBalanceContent = document.getElementById("myBalanceContent");
        myBalanceContent.innerHTML = "";
        let clientNo = document.getElementById("clientNoForBalance");
        fetch('http://localhost:8080/balance/' + clientNo.value)
            .then(result => result.json())
            .then(
                function (balance){
                    myBalanceContent.append("Kontol nr: " + clientNo.value +
                        " on vabasid vahendeid " +balance + " € väärtuses.");
                }
            )
    }

    let historyButton = document.getElementById("historyButton");
    historyButton.onclick = function (){
        let historyContent=document.getElementById("historyContent");
        let historyTable = document.createElement("table");
        historyTable.innerHTML = "";
        historyTable.setAttribute("border", "1");
        let clientNo = document.getElementById("clientNoForHistory");
        fetch('http://localhost:8080/transactions/' + clientNo.value)
            .then(result => result.json())
            .then(
                function (history){
                    historyTable.innerHTML = "";
                    let newRow = document.createElement("tr");
                    let newCell = document.createElement("td");
                    newCell.innerText = "Id";
                    newRow.append(newCell);
                    let newCell2 = document.createElement("td");
                    newCell2.innerText = "Account no";
                    newRow.append(newCell2);
                    let newCell3 = document.createElement("td");
                    newCell3.innerText = "Transaction type";
                    newRow.append(newCell3);
                    let newCell4 = document.createElement("td");
                    newCell4.innerText = "Amount";
                    newRow.append(newCell4);
                    historyTable.append(newRow);

                    for (let i= 0; i <history.length; i++){
                        let newRow = document.createElement("tr");
                        let newCell = document.createElement("td");
                        newCell.innerText = history[i].transactionID;
                        newRow.append(newCell);
                        let newCell2 = document.createElement("td");
                        newCell2.innerText = history[i].accountNo;
                        newRow.append(newCell2);
                        let newCell3 = document.createElement("td");
                        newCell3.innerText = history[i].transactionType;
                        newRow.append(newCell3);
                        let newCell4 = document.createElement("td");
                        newCell4.innerText = history[i].amount;
                        newRow.append(newCell4);
                        historyTable.append(newRow);
                    }
                    historyContent.append(historyTable);
                }
            )
    }

    let myAccountsButton = document.getElementById("myAccountsButton");
    myAccountsButton.onclick = function (){
        let clientNo = document.getElementById("clientNoForAccounts");
        fetch('http://localhost:8080/myAccounts/' + clientNo.value)
            .then(result => result.json())
            .then(accountsList)
            .then(myAccountsContent.append(accountsTable))
    }

    let depositButton = document.getElementById("depositButton");
    depositButton.onclick = function (){
        let accountNo = document.getElementById("transactionAccountNo");
        let amount = document.getElementById("transactionAmount");
        fetch('http://localhost:8080/deposit/' + accountNo.value,
            {
                method: 'PUT',
                headers: {
                    'Content-Type':'application/json'
                },
                body: JSON.stringify({amount: amount.value})
            })
            .then(result =>result.text())
            .then(function (deposit){
                    alert(deposit);
                }
            )
    }


    let withdrawButton = document.getElementById("withdrawButton");
    withdrawButton.onclick = function (){
        let accountNo = document.getElementById("transactionAccountNo");
        let amount = document.getElementById("transactionAmount");
        fetch('http://localhost:8080/withdraw/' + accountNo.value+'?amount=' + amount.value,
            {
                method: 'PUT',
                headers: {
                    'Content-Type':'application/json'
                }
            })
            .then(result =>result.text())
            .then(function (withdraw){
                    alert(withdraw);
                }
            )
    }

</script>

</body>
</html>